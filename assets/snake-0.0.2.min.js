!function e(t,n,o){function i(s,a){if(!n[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(r)return r(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var h=n[s]={exports:{}};t[s][0].call(h.exports,function(e){var n=t[s][1][e];return i(n||e)},h,h.exports,e,t,n,o)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<o.length;s++)i(o[s]);return i}({1:[function(e,t,n){(function(e){!function(e,n){"use strict";"object"==typeof t&&"object"==typeof t.exports?t.exports=n(e):n(e)}("undefined"!=typeof window?window:e,function(e){"use strict";var t=Object.defineProperty,n=Object.defineProperties,o=Array.prototype.slice,i=(Array.prototype.forEach,Array.isArray),r=Math.floor,s=Math.abs,a="object"==typeof e.ES6?e.ES6:e.ES6={},u=Math.max,c=(Math.min,function(e){return"function"==typeof e}),h=function(e){return null!==e&&("object"==typeof e||"function"==typeof e)},d=function(e,t){if(!c(e))throw new TypeError(e+" is not a function");var n=o.call(arguments,2);setTimeout(function(){e.apply(t,n)})},l=function e(t){if(!(this instanceof e)||O(this))throw new TypeError(String(this)+" is not a promise");if(!c(t))throw new TypeError("Promise resolver "+String(t)+" is not a function");w(this);try{t(function(e){this._resolve(e)}.bind(this),function(e){this._reject(e)}.bind(this))}catch(e){this._reject(e)}};l.resolve=function(e){return O(e)?e:new l(function(t,n){p(e)?d(function(){try{e.then(t,n)}catch(e){n(e)}}):t(e)})},l.reject=function(e){return new l(function(t,n){n(e)})},l.race=function(e){if(void 0===e||null===e)return new l(function(e,t){d(t,void 0,TypeError("First argument of Promise.race can not be undefined or null"))});var t,o=!1;return t=Number(e.length),t=t!==t?0:t,t=(t<0?-1:1)*r(s(t)),t=u(t,0),new l(function(i,r){var s,a=0;for(s=function(e){var t,s;O(e)?b(e)?o||(o=!0,d(function(){i(e._value)})):E(e)?o||(o=!0,d(function(){r(e._reason)})):g(e)&&(t=e._resolve,s=e._reject,n(e,{_resolve:{value:function(e){t(e),o||(o=!0,i(e))}.bind(e)},_reject:{value:function(e){s(e),o||(o=!0,r(e))}.bind(e)}})):p(e)?d(function(){try{e.then(function(e){o||(o=!0,i(e))},function(e){o||(o=!0,r(e))})}catch(e){r(e)}}):o||(o=!0,d(function(){i(e)}))};a<t;++a)s(e[a])})},l.all=function(e){if(void 0===e||null===e)return new l(function(e,t){d(t,void 0,TypeError("First argument of Promise.all can not be undefined or null"))});var t,o,i=0;return t=Number(e.length),t=t!==t?0:t,t=(t<0?-1:1)*r(s(t)),t=u(t,0),o=new Array(t),new l(function(r,s){var a,u=0;if(0===t)r(o);else for(a=function(e,a){var u,c;O(e)?b(e)?(o[a]=e._value,++i===t&&d(function(){r(o)})):E(e)?d(function(){s(e._reason)}):g(e)&&(u=e._resolve,c=e._reject,n(e,{_resolve:{value:function(e){u(e),o[a]=e,++i===t&&r(o)}.bind(e)},_reject:{value:function(e){c(e),s(e)}.bind(e)}})):p(e)?d(function(){try{e.then(function(e){o[a]=e,++i===t&&r(o)},function(e){s(e)})}catch(e){s(e)}}):(o[a]=e,++i===t&&d(function(){r(o)}))};u<t;++u)a(e[u],u)})},l.prototype.then=function(e,t){if(!O(this))throw new TypeError(this+" is not a promise");e=c(e)?e:m,t=c(t)?t:v;var n,o,i=new l(function(e,t){});return n=function(t){var n;try{n=e(t),f(n,i)}catch(e){i._reject(e)}},o=function(e){var n;try{n=t(e),f(n,i)}catch(e){i._reject(e)}},g(this)?(this._onFulfilled.push(n),this._onRejected.push(o)):b(this)?d(n,void 0,this._value):E(this)&&d(o,void 0,this._reason),i};var f=function(e,t){var o,i;O(e)?b(e)?t._resolve(e._value):E(e)?t._reject(e._reason):g(e)&&(o=e._resolve,i=e._reject,n(e,{_resolve:{value:function(e){o(e),t._resolve(e)}.bind(e)},_reject:{value:function(e){i(e),t._reject(e)}.bind(e)}})):p(e)?d(function(){try{e.then(function(e){this._resolve(e)}.bind(t),function(e){this._reject(e)}.bind(t))}catch(e){t._reject(e)}}):t._resolve(e)};l.prototype.catch=function(e){if(!c(this.then))throw new TypeError("(var).then is not a function");return this.then(void 0,e)},l.prototype.toString=function(){if(!O(this))throw new TypeError(this+" is not a promise");switch(this._state){case"pending":return"Promise { <pending> }";case"fulfilled":return"Promise { "+this._value+" }";case"rejected":return"Promise { <rejected> "+this._reason+" }"}};var p=function(e){return h(e)&&c(e.then)},m=function(e){return l.resolve(e)},v=function(e){return l.reject(e)},y=function(e){P(this)||(n(this,{_state:{value:"fulfilled"},_value:{value:e}}),this._onFulfilled.length>0&&d(function(e){this._onFulfilled.forEach(function(t){t(e)}),this._onFulfilled.length=0,this._onRejected.length=0},this,e))},_=function(e){P(this)||(n(this,{_state:{value:"rejected"},_reason:{value:e}}),this._onRejected.length>0&&d(function(e){this._onRejected.forEach(function(t){t(e)}),this._onFulfilled.length=0,this._onRejected.length=0},this,e))},w=function(e){n(e,{_isPromise:{value:!0},_onFulfilled:{value:[]},_onRejected:{value:[]},_resolve:{value:y.bind(e),configurable:!0},_reject:{value:_.bind(e),configurable:!0},_state:{value:"pending",configurable:!0},_value:{value:void 0,configurable:!0},_reason:{value:void 0,configurable:!0}})},g=function(e){return"pending"===e._state},b=function(e){return"fulfilled"===e._state},E=function(e){return"rejected"===e._state},P=function(e){return"fulfilled"===e._state||"rejected"===e._state},L=function(e){return-1!==["pending","fulfilled","rejected"].indexOf(String(e))},C=function(e){return!0===e._isPromise&&i(e._onFulfilled)&&i(e._onRejected)&&c(e._resolve)&&c(e._reject)&&L(e._state)&&e.hasOwnProperty("_value")&&e.hasOwnProperty("_reason")},O=function(e){return e instanceof l&&C(e)};return n(a,{isPromise:{value:O,writable:!0,configurable:!0}}),t(e,"Promise",{value:l,writable:!0,configurable:!0}),a})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),e("es6-promise-shim");var o=e("./ui/Dom"),i=e("./ui/Popup"),r=e("./Assets"),s=e("./controls/KeyboardControls"),a=e("./controls/TouchControls"),u=e("./game/Game"),c=e("./ui/Score"),h=e("./ui/MuteButton"),d=e("./ui/GameOverPopup"),l=e("./ui/LoaderPopup"),f=new(function(){function e(e){this.body=new o.Dom(e),this.keyboard=new s.KeyboardControls,this.touch=new a.TouchControls,this.score=new c.Score(this.body),this.muteButton=new h.MuteButton(this.body)}return e.prototype.reset=function(){this.score.resetPoints(),this.game.reset()},e.prototype.pause=function(){var e=this;this.game.paused||!this.game.started||this.game.worm.dead||(this.keyboard.deattach(this.game),this.touch.deattach(this.game),this.game.pause(),i.Popup.open({header:"Paused",body:"Game is now paused.",button:"Resume",classes:["c-modal--with-animation"]}).result.then(function(){return e.resume()}).catch(function(){return e.resume()}))},e.prototype.resume=function(){this.keyboard.attach(this.game),this.touch.attach(this.game),this.game.resume()},e.prototype.registerServiceWorker=function(){"serviceWorker"in navigator&&navigator.serviceWorker.register("/service-worker.js").then(function(e){console.log("ServiceWorker registration successful with scope: ",e.scope)},function(e){console.log("ServiceWorker registration failed: ",e)})},e.prototype.init=function(){var e=this,t=this.body.names.gameCanvas;this.game=new u.Game(15,15,t),this.keyboard.attach(this.game),this.touch.attach(this.game),this.game.emitter.on(u.GameEvents.GAME_OVER,function(){e.muteButton.mute||r.Assets.dead.play(),e.beforeinstallprompt&&(e.beforeinstallprompt.prompt(),e.beforeinstallprompt=void 0),d.GameOverPopup.open(e.score.points).result.then(function(){return e.reset()}).catch(function(){return e.reset()})}),this.game.emitter.on(u.GameEvents.ADD_POINT,function(){e.score.addPoint(),e.muteButton.mute||r.Assets.point.play()}),this.game.emitter.on(u.GameEvents.KEY,function(){e.muteButton.mute||r.Assets.pop.play()}),this.body.on("click",this.body.names.pauseButton,function(t){e.pause()}),this.body.on("click",this.body.names.soundButton,function(t){e.muteButton.toggleMute()})},e}())(window.document.getElementsByTagName("body")[0]),p=l.LoaderPopup.open();window.addEventListener("beforeinstallprompt",function(e){return f.beforeinstallprompt=e,e.preventDefault(),!1}),document.addEventListener("pause",function(){return f.pause()},!1),window.onblur=function(){f.pause()},r.Assets.loadAll().then(function(){p.close("done"),f.init(),f.registerServiceWorker()}).catch(function(){p.dismiss("error"),i.Popup.open({header:"Uh, oh!",classes:["c-modal--with-animation","c-modal--with-error"],body:new o.Dom("<h3>The game was not initialized correctly.</h3>"),button:"Reload",buttonCallback:function(){return window.location.reload()},backdrop:!1})})},{"./Assets":3,"./controls/KeyboardControls":6,"./controls/TouchControls":8,"./game/Game":10,"./ui/Dom":14,"./ui/GameOverPopup":16,"./ui/LoaderPopup":17,"./ui/MuteButton":18,"./ui/Popup":19,"./ui/Score":20,"es6-promise-shim":1}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=e("./Sound"),i=function(){function e(){}return e.loadImage=function(e){return new Promise(function(t,n){var o=new Image;o.src=e,o.onload=function(){t(o)},o.onerror=function(){n(null)}})},e.loadAll=function(){var e=this;return this.loadImage("images/berry-small.png").then(function(t){return e.berry=t}).then(function(){return e.loadImage("images/snake-head.png")}).then(function(t){return e.head=t}).then(function(){return e.pop=new o.Sound("images/pop.mp3"),e.pop.load()}).then(function(){return e.point=new o.Sound("images/point.mp3"),e.point.load()}).then(function(){return e.dead=new o.Sound("images/dead.mp3"),e.dead.load()})},e}();n.Assets=i},{"./Sound":4}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e){this.loaded=!1,this.path=e}return e.prototype.loadAudioCtx=function(){var t=this;return new Promise(function(n,o){var i=new XMLHttpRequest;i.open("GET",t.path,!0),i.responseType="arraybuffer",i.onload=function(){var r=i.response;e.audioCtx.decodeAudioData(r,function(e){t.buffer=e,t.loaded=!0,n(t)},function(e){o(null)})},i.onerror=function(e){o(null)},i.send()})},e.prototype.load=function(){var t=this;return e.audioCtx?this.loadAudioCtx():new Promise(function(e,n){t.audio=new Audio(t.path),t.audio.onloadeddata=function(){t.loaded=!0,e(t)},t.audio.onerror=function(e){console.error(e),n(null)}})},e.prototype.play=function(){if(this.loaded)if(e.audioCtx&&this.buffer){var t=e.audioCtx.createBufferSource();t.buffer=this.buffer,t.connect(e.audioCtx.destination),t.start(0)}else this.audio&&(this.audio.paused?this.audio.play():this.audio.currentTime=0)},e}();n.Sound=o,function(){var e=window.AudioContext||window.webkitAudioContext;if(e&&(o.audioCtx=new e,"suspended"===o.audioCtx.state)){var t=document.body,n=function(){o.audioCtx.resume(),setTimeout(function(){"running"===o.audioCtx.state&&(t.removeEventListener("touchstart",n,!1),t.removeEventListener("keydown",n,!1))})};t.addEventListener("touchstart",n,!1),t.addEventListener("keydown",n,!1)}}()},{}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(){this.listeners=[]}return e.prototype.attach=function(e){this.listeners.push(e)},e.prototype.deattach=function(e){var t=this.listeners.indexOf(e);-1!==t&&this.listeners.splice(t,1)},e.prototype.triggerKey=function(e){for(var t=0;t<this.listeners.length;t++)this.listeners[t].onKey(e)},e}();n.Controls=o},{}],6:[function(e,t,n){"use strict";var o=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();Object.defineProperty(n,"__esModule",{value:!0});var i=e("./Keys"),r=e("./Controls"),s={38:i.Keys.UP,37:i.Keys.LEFT,40:i.Keys.DOWN,39:i.Keys.RIGHT,87:i.Keys.UP,65:i.Keys.LEFT,83:i.Keys.DOWN,68:i.Keys.RIGHT},a=function(e){function t(){var t=e.call(this)||this;return t.keyDownCallback=function(e){var n=e.keyCode||e.which,o=s[n];void 0!==o&&t.triggerKey(o)},t.keyDownCallback=t.keyDownCallback.bind(t),window.addEventListener("keydown",t.keyDownCallback),t}return o(t,e),t.prototype.remove=function(){window.removeEventListener("keydown",this.keyDownCallback)},t}(r.Controls);n.KeyboardControls=a},{"./Controls":5,"./Keys":7}],7:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});!function(e){e[e.UP=0]="UP",e[e.DOWN=1]="DOWN",e[e.LEFT=2]="LEFT",e[e.RIGHT=3]="RIGHT",e[e.ACTION=4]="ACTION"}(n.Keys||(n.Keys={}))},{}],8:[function(e,t,n){"use strict";var o=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();Object.defineProperty(n,"__esModule",{value:!0});var i=e("./Keys"),r=e("./Controls"),s=Math.min(window.innerWidth,window.innerHeight)/10,a=function(e){function t(){var t=e.call(this)||this;return t.queue=[],t.pressTime=0,t.moved=!1,t.onStart=function(e){t.pressTime=Date.now(),t.moved=!1},t.onMove=function(e){t.pressTime&&(t.appendPos(e.touches[0].clientX,e.touches[0].clientY),t.checkMove(),e.preventDefault())},t.onStop=function(e){Date.now();t.pressTime=0},t.onCancel=function(e){t.pressTime=0},window.addEventListener("touchstart",t.onStart),window.addEventListener("touchmove",t.onMove),window.addEventListener("touchend",t.onStop),window.addEventListener("touchcancel",t.onCancel),t}return o(t,e),t.prototype.appendPos=function(e,t){var n={x:e,y:t,time:Date.now()},o=n.time-200;this.queue.push(n);for(var i=this.queue.length-1;i>=0;i--)if(this.queue[i].time<o){this.queue.splice(0,i+1);break}},t.prototype.checkMove=function(){var e=this.queue.length;if(!(e<2)){var t=this.queue[0],n=this.queue[e-1],o=t.x-n.x,r=t.y-n.y;Math.abs(o)>=Math.abs(r)?o>s?(this.triggerKey(i.Keys.LEFT),this.moved=!0):o<-s&&(this.triggerKey(i.Keys.RIGHT),this.moved=!0):r>s?(this.triggerKey(i.Keys.UP),this.moved=!0):r<-s&&(this.triggerKey(i.Keys.DOWN),this.moved=!0)}},t.prototype.remove=function(){window.removeEventListener("touchstart",this.onStart),window.removeEventListener("touchmove",this.onMove),window.removeEventListener("touchend",this.onStop),window.removeEventListener("touchcancel",this.onCancel)},t}(r.Controls);n.TouchControls=a},{"./Controls":5,"./Keys":7}],9:[function(e,t,n){"use strict";var o=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();Object.defineProperty(n,"__esModule",{value:!0});var i=e("../Assets"),r=e("./Point"),s=e("./Renderer"),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.render=function(e,t){var n,o,r,a,u;n=this.x*s.CELL_SIZE,o=this.y*s.CELL_SIZE,(r=t%800/800)>.5&&(r=1-r),a=4*r,u=s.CELL_SIZE-2*a,e.drawImage(i.Assets.berry,0,0,32,32,n+a,o+a,u,u)},t}(r.Point);n.Berry=a},{"../Assets":3,"./Point":11,"./Renderer":12}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o,i=e("./Berry"),r=e("./Worm"),s=e("./Renderer"),a=e("../ui/Emitter"),u=e("../controls/Keys");!function(e){e[e.GAME_OVER=0]="GAME_OVER",e[e.ADD_POINT=1]="ADD_POINT",e[e.KEY=2]="KEY"}(o=n.GameEvents||(n.GameEvents={}));var c=function(){function e(e,t,n){var o=this;this.paused=!1,this.started=!1,this.sizeX=e,this.sizeY=t,this.renderer=new s.Renderer(e,t,n),this.emitter=new a.Emitter,this.gameLoop=function(e){if(!o.paused&&o.started&&!o.worm.dead){var t=0;void 0!==o.frameTime&&(t=e-o.frameTime),o.frameTime=e,o.simulate(t),o.updateFrame(e),requestAnimationFrame(o.gameLoop)}},this.gameLoop=this.gameLoop.bind(this),this.reset()}return e.prototype.reset=function(){this.started=!1,this.worm=new r.Worm(2,Math.floor(this.sizeY/2),u.Keys.RIGHT),this.berries=[],this.frameTime=void 0,this.updateBoard(),this.addBerry(),this.updateFrame()},e.prototype.updateBoard=function(){var e=this;this.board=new Array(this.sizeX);for(var t=0;t<this.sizeX;t++)this.board[t]=new Array(this.sizeY);this.worm.segments.forEach(function(t){return e.board[t.x][t.y]=t})},e.prototype.updateFrame=function(e){void 0===e&&(e=0),this.renderer.clearFrame(),this.render(this.renderer.ctx,e)},e.prototype.addBerry=function(){for(var e,t,n=this.sizeX*this.sizeY,o=Math.round(Math.random()*(n-1)),r=0;r<n&&(e=(r+o)%this.sizeX,t=Math.floor((r+o)/this.sizeX)%this.sizeY,this.board[e][t]);r++);var s=new i.Berry(e,t);this.berries.push(s),this.board[e][t]=s},e.prototype.growWorm=function(e){var t=this.worm.segments.length;t>150||(t>102&&(this.worm.color=r.WORM_COLOR_BIG),e.swallowing=!0,this.worm.speed+=.04)},e.prototype.simulate=function(e){var t,n,s,a=!1;for(this.worm.offset+=this.worm.speed*e/1e3,this.worm.offset>=1&&((t=this.worm.segments[this.worm.segments.length-1]).direction!==this.worm.direction&&(a=!0),t=this.worm.createNewSegment());this.worm.offset>=1;)if(this.board[t.x][t.y]instanceof i.Berry&&(this.growWorm(t),s=this.berries.indexOf(this.board[t.x][t.y]),this.berries.splice(s,1),this.emitter.trigger(o.ADD_POINT),this.addBerry()),(n=this.worm.segments[0]).swallowing||(this.worm.segments.shift(),this.board[n.x][n.y]=void 0),n.swallowing=!1,this.worm.segments.push(t),this.board[t.x][t.y]=t,this.worm.offset-=1,(t=this.worm.createNewSegment()).x<0||t.y<0||t.x>=this.sizeX||t.y>=this.sizeY||this.board[t.x][t.y]instanceof r.WormSegment)return this.worm.dead=!0,this.worm.offset=0,void this.emitter.trigger(o.GAME_OVER);a&&!this.worm.dead&&this.emitter.trigger(o.KEY)},e.prototype.pause=function(){this.paused=!0},e.prototype.resume=function(){this.paused=!1,this.frameTime=void 0,requestAnimationFrame(this.gameLoop)},e.prototype.render=function(e,t){for(var n=0;n<this.berries.length;n++)this.berries[n].render(e,t);this.worm.render(e,t)},e.prototype.onKey=function(e){!1===this.started&&(this.started=!0,requestAnimationFrame(this.gameLoop));var t=this.worm.segments[this.worm.segments.length-1];e===u.Keys.UP&&t.direction!==u.Keys.DOWN?this.worm.direction=e:e===u.Keys.DOWN&&t.direction!==u.Keys.UP?this.worm.direction=e:e===u.Keys.LEFT&&t.direction!==u.Keys.RIGHT?this.worm.direction=e:e===u.Keys.RIGHT&&t.direction!==u.Keys.LEFT&&(this.worm.direction=e)},e}();n.Game=c},{"../controls/Keys":7,"../ui/Emitter":15,"./Berry":9,"./Renderer":12,"./Worm":13}],11:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=function(){return function(e,t){this.x=e,this.y=t}}();n.Point=o},{}],12:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.CELL_SIZE=32;var o=function(){function e(e,t,o){this.canvas=o,this.sizeX=e,this.sizeY=t,this.canvas.width=n.CELL_SIZE*e,this.canvas.height=n.CELL_SIZE*t,this.ctx=o.getContext("2d")}return e.prototype.clearFrame=function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)},e}();n.Renderer=o},{}],13:[function(e,t,n){"use strict";var o=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();Object.defineProperty(n,"__esModule",{value:!0});var i=e("../Assets"),r=e("./Point"),s=e("./Renderer"),a=e("../controls/Keys"),u=function(e){function t(t,n,o){var i=e.call(this,t,n)||this;return i.swallowing=!1,i.direction=o,i}return o(t,e),t}(r.Point);n.WormSegment=u,n.WORM_COLOR_DEFAULT="#4c9ed9",n.WORM_COLOR_BIG="#ff5d5d";var c=function(){function e(e,t,o,i){for(void 0===i&&(i=3),this.speed=4,this.offset=0,this.dead=!1,this.color=n.WORM_COLOR_DEFAULT,this.direction=o,this.segments=[],this.segments.push(new u(e,t,o));this.segments.length<i;)this.segments.push(this.createNewSegment())}return e.prototype.moveX=function(e,t,n){switch(void 0===n&&(n=1),t){case a.Keys.LEFT:return e-n;case a.Keys.RIGHT:return e+n}return e},e.prototype.moveY=function(e,t,n){switch(void 0===n&&(n=1),t){case a.Keys.UP:return e-n;case a.Keys.DOWN:return e+n}return e},e.prototype.createNewSegment=function(){var e=this.segments[this.segments.length-1],t=new u(e.x,e.y,this.direction);return t.x=this.moveX(t.x,e.direction),t.y=this.moveY(t.y,e.direction),t},e.prototype.drawFace=function(e,t,n,o,r){var s=0;this.dead?s=2:r%2e3<1e3&&r%1e3>700&&(s=1),e.drawImage(i.Assets.head,20*t.direction,20*s,20,20,n,o,20,20)},e.prototype.render=function(e,t){var n,o,i,r=.3125,a=this.segments[0],u=this.segments[this.segments.length-1],c=a.x,h=a.y;i=.4*s.CELL_SIZE,e.fillStyle=this.color,e.strokeStyle=this.color,e.lineWidth=2*r*s.CELL_SIZE,e.lineJoin="round",e.lineCap="round",a.swallowing||(c=this.moveX(a.x,a.direction,this.offset),h=this.moveY(a.y,a.direction,this.offset)),n=(c+r+.1875)*s.CELL_SIZE,o=(h+r+.1875)*s.CELL_SIZE,e.beginPath(),e.moveTo(n,o);for(d=1;d<this.segments.length;d++)this.segments[d-1].direction!==this.segments[d].direction&&(n=(this.segments[d].x+r+.1875)*s.CELL_SIZE,o=(this.segments[d].y+r+.1875)*s.CELL_SIZE,e.lineTo(n,o));c=this.moveX(u.x,u.direction,this.offset),h=this.moveY(u.y,u.direction,this.offset),n=(c+r+.1875)*s.CELL_SIZE,o=(h+r+.1875)*s.CELL_SIZE,e.lineTo(n,o),e.stroke();for(var d=0;d<this.segments.length;d++)this.segments[d].swallowing&&(n=(this.segments[d].x+r+.1875)*s.CELL_SIZE,o=(this.segments[d].y+r+.1875)*s.CELL_SIZE,e.beginPath(),e.arc(n,o,i,0,2*Math.PI),e.fill());n=(c+.1875)*s.CELL_SIZE,o=(h+.1875)*s.CELL_SIZE,this.drawFace(e,u,n,o,t)},e}();n.Worm=c},{"../Assets":3,"../controls/Keys":7,"./Point":11,"./Renderer":12}],14:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=1,i=function(){function e(e){this.names={};var t,n;if(e.nodeType===o?n=e:((t=window.document.createElement("div")).innerHTML=e,n=this.findFirstElement(t.childNodes)),!n)throw new Error("Failed to compile template: "+e);this.generateNamedElements(n),this.element=n,this.listeners=[]}return e.prototype.findFirstElement=function(e){for(var t=null,n=0;n<e.length;n++)if((t=e.item(n)).nodeType===o)return t;return null},e.prototype.generateNamedElements=function(e){for(var t,n=e.querySelectorAll("[data-name]"),o=0;o<n.length;o++)t=n[o].getAttribute("data-name"),this.names[t]=n[o]},e.prototype.append=function(t){if(t instanceof Array)for(var n=0;n<t.length;n++)this.append(t[n]);else t instanceof e&&(t=t.element),this.element.appendChild(t)},e.prototype.remove=function(t){t instanceof e&&(t=t.element),this.element.removeChild(t)},e.setText=function(e,t){var n=document.createTextNode(t);e.innerText=n.textContent},e.prototype.on=function(e,t,n){2===arguments.length&&(n=arguments[1],t=this.element),this.listeners.push({event:e,element:t,callback:n}),t.addEventListener(e,n)},e.prototype.off=function(e,t,n){void 0===e&&(e=void 0),void 0===t&&(t=void 0),void 0===n&&(n=void 0);for(var o,i=this.listeners.length-1;i>=0;i--)(function(o){return void 0===e||e===o.element&&(void 0===t||t===o.event&&(void 0===n||n===o.callback))})(o=this.listeners[i])&&(o.element.removeEventListener(o.event,o.callback),this.listeners.splice(i,1))},e}();n.Dom=i},{}],15:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(){this.listeners=[]}return e.prototype.on=function(e,t){this.listeners.push({event:e,callback:t})},e.prototype.off=function(e,t){for(var n=this.listeners.length-1;n>=0;n--)(function(n){return void 0===e||e===n.event&&(void 0===t||t===n.callback)})(this.listeners[n])&&this.listeners.splice(n,1)},e.prototype.trigger=function(e,t){for(var n,o=this.listeners.length-1;o>=0;o--)(n=this.listeners[o]).event===e&&n.callback.call(null,t)},e}();n.Emitter=o},{}],16:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=e("./Dom"),i=e("./Popup"),r=function(){function e(){}return e.open=function(e){var t='<div class="u-text-center"><h3>Your final score is:</h3><div class="c-score c-score--huge c-score--points">'+e+"</div></div>";return i.Popup.open({header:"Well done!",body:new o.Dom(t),backdrop:!1,button:"Try again",classes:["c-modal--with-animation"]})},e}();n.GameOverPopup=r},{"./Dom":14,"./Popup":19}],17:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=e("./Dom"),i=e("./Popup"),r=function(){function e(){}return e.open=function(){return i.Popup.open({header:"Loading",body:new o.Dom('<div class="c-loader">\n    <span class="c-loader__ball"></span>\n    <span class="c-loader__ball"></span>\n    <span class="c-loader__ball"></span>\n    <span class="c-loader__ball"></span>\n    <span class="c-loader__ball"></span>\n</div>'),classes:["c-modal--transparent"],backdrop:!1})},e}();n.LoaderPopup=r},{"./Dom":14,"./Popup":19}],18:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e){this.mute=!1,this.soundElement=e.names.soundButton,this.loadMute()}return e.prototype.loadMute=function(){var e=window.localStorage.getItem("sound");null!==e&&(this.mute="true"===e),this.mute?this.soundElement.classList.add("muted"):this.soundElement.classList.remove("muted")},e.prototype.toggleMute=function(){this.mute=!this.mute,window.localStorage.setItem("sound",this.mute?"true":"false"),this.mute?this.soundElement.classList.add("muted"):this.soundElement.classList.remove("muted")},e.prototype.play=function(e){this.mute||(e.paused?e.play():e.currentTime=0)},e}();n.MuteButton=o},{}],19:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=e("./Dom"),i=function(){function e(e,t){void 0===t&&(t=void 0);var n=this;this.result=new Promise(function(e,t){n.resolve=e,n.reject=t}),this.element=e,void 0===t&&(t=window.document.getElementsByTagName("body")[0]),this.container=t,this.container.appendChild(this.element.element)}return e.prototype.close=function(e){this.resolve(e),this.element.off(),this.container.removeChild(this.element.element)},e.prototype.dismiss=function(e){this.reject(e),this.element.off(),this.container.removeChild(this.element.element)},e.open=function(t){var n,i=new o.Dom('\n<div class="c-modal">\n    <div class="c-modal__popup c-modal__popup--sm" data-name="popup">\n        <div class="c-modal__popup__header"><h2 data-name="header"></h2></div>\n        <div class="c-modal__popup__body" data-name="message"></div>\n        <div class="c-modal__popup__footer" data-name="footer"></div>\n    </div>\n</div>');t.classes&&t.classes.forEach(function(e){return i.element.classList.add(e)}),n=t.body instanceof o.Dom?t.body:new o.Dom("<p>"+t.body+"</p>"),o.Dom.setText(i.names.header,t.header),i.names.message.appendChild(n.element);var r=new e(i);return i.on("click",i.names.popup,function(e){e.stopPropagation(),e.preventDefault()}),t.button&&(n=new o.Dom('<span class="c-modal__button">'+t.button+"</span>"),i.names.footer.appendChild(n.element),i.on("click",n.element,function(e){t.buttonCallback?t.buttonCallback():r.close("button")})),!1!==t.backdrop&&i.on("click",i.element,function(e){r.dismiss("overlay")}),r},e}();n.Popup=i},{"./Dom":14}],20:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=e("./Dom"),i=["#71beb8","#03A9F4","#1fda5e","#FFBB00","#FB6542","#fd81fb","#067a00","#0008a8","#8d0000","#ccc","#000"],r=function(){function e(e){this.hiscore=0,this.points=0,this.body=e,this.pointsElement=e.names.points,this.hiscoreElement=e.names.hiscore,this.loadHiscore(),o.Dom.setText(this.hiscoreElement,String(this.hiscore))}return e.prototype.loadHiscore=function(){this.hiscore=0;var e=window.localStorage.getItem("hiscore");null!==e&&(this.hiscore=parseInt(e,10))},e.prototype.setHiscore=function(e){this.hiscore=e,window.localStorage.setItem("hiscore",String(e)),o.Dom.setText(this.hiscoreElement,String(this.hiscore))},e.prototype.updateBodyColor=function(){var e=Math.floor(this.points/10);e%=i.length,this.body.element.style.background!==i[e]&&(this.body.element.style.background=i[e])},e.prototype.addPoint=function(e){void 0===e&&(e=1),this.points+=e,this.updateBodyColor(),o.Dom.setText(this.pointsElement,String(this.points)),this.points>this.hiscore&&this.setHiscore(this.points)},e.prototype.resetPoints=function(){this.points=0,this.updateBodyColor(),o.Dom.setText(this.pointsElement,String(this.points))},e}();n.Score=r},{"./Dom":14}]},{},[2,3,5,6,7,8,9,10,11,12,13,4,14,15,16,17,18,19,20]);
//# sourceMappingURL=snake-0.0.2.min.js.map